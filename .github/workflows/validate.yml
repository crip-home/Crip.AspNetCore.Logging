name: Build and test

on:
  push:
    branches: [ features/* ]
  pull_request:
    branches:
      - main
      - master

jobs:
  init:
    runs-on: ubuntu-latest
    steps:
      - name: Cancel Workflow Action
        uses: styfle/cancel-workflow-action@0.10.0
        with:
          access_token: ${{ github.token }}

  build:
    env:
      TESTS: Crip.AspNetCore.Logging.Tests/Crip.AspNetCore.Logging.Tests.csproj

    runs-on: ubuntu-latest
    needs: init
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: ðŸ”¨ Setup .NET 3.1 & 6.0
        uses: actions/setup-dotnet@v2
        with:
          dotnet-version: |
            3.1.x
            6.0.x

      - name: Install dependencies
        run: dotnet restore $TESTS -v m

      - name: Build solution
        run: dotnet build $TESTS --no-restore -c Debug -v m

      - name: Test Crip.AspNetCore.Logging.Tests
        run: dotnet test $TESTS --no-restore --no-build -v m
